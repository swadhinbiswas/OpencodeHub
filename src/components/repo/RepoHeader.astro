---
import {
  GitBranch,
  Star,
  GitFork,
  Eye,
  Code,
  FileText,
  Settings,
  Lock,
  Globe,
  PlayCircle,
  Book,
  Shield,
  BarChart2,
  GitPullRequest,
  Layout,
  ChevronDown,
} from "lucide-react";

interface Props {
  repo: {
    owner: string;
    name: string;
    description?: string | null;
    visibility: string;
    topics?: string[];
    watchers?: number;
    forks?: number;
    stars?: number;
    openIssueCount?: number;
    openPrCount?: number;
  };
  activeTab:
    | "code"
    | "issues"
    | "pulls"
    | "actions"
    | "projects"
    | "wiki"
    | "security"
    | "insights"
    | "settings";
}

const { repo, activeTab } = Astro.props;

const tabs = [
  {
    id: "code",
    label: "Code",
    icon: Code,
    href: `/${repo.owner}/${repo.name}`,
  },
  {
    id: "issues",
    label: "Issues",
    icon: FileText,
    href: `/${repo.owner}/${repo.name}/issues`,
    count: repo.openIssueCount,
  },
  {
    id: "pulls",
    label: "Pull Requests",
    icon: GitPullRequest,
    href: `/${repo.owner}/${repo.name}/pulls`,
    count: repo.openPrCount,
  },
  {
    id: "actions",
    label: "Actions",
    icon: PlayCircle,
    href: `/${repo.owner}/${repo.name}/actions`,
  },
  {
    id: "projects",
    label: "Projects",
    icon: Layout,
    href: `/${repo.owner}/${repo.name}/projects`,
  },
  {
    id: "wiki",
    label: "Wiki",
    icon: Book,
    href: `/${repo.owner}/${repo.name}/wiki`,
  },
  {
    id: "security",
    label: "Security",
    icon: Shield,
    href: `/${repo.owner}/${repo.name}/security`,
  },
  {
    id: "insights",
    label: "Insights",
    icon: BarChart2,
    href: `/${repo.owner}/${repo.name}/insights`,
  },
  {
    id: "settings",
    label: "Settings",
    icon: Settings,
    href: `/${repo.owner}/${repo.name}/settings`,
  },
];
---

<!-- Enhanced Repo Header -->
<div class="mb-6">
  <!-- Top Section: Repo Name & Action Buttons -->
  <div class="flex flex-col lg:flex-row lg:items-center justify-between gap-4 py-4 border-b border-white/10">
    <!-- Repo Info -->
    <div class="space-y-2">
      <!-- Repo Name - BIGGER and more prominent -->
      <div class="flex items-center gap-3 flex-wrap">
        <a 
          href={`/${repo.owner}`} 
          class="text-xl font-semibold text-cyan-400 hover:underline transition-colors"
        >
          {repo.owner}
        </a>
        <span class="text-xl text-gray-500">/</span>
        <a
          href={`/${repo.owner}/${repo.name}`}
          class="text-xl font-bold text-white hover:text-cyan-400 transition-colors"
        >
          {repo.name}
        </a>
        <!-- Visibility Badge -->
        <span
          class="inline-flex items-center gap-1 rounded-full border border-white/20 bg-white/5 px-2.5 py-1 text-xs font-medium text-gray-400"
        >
          {
            repo.visibility === "public" ? (
              <>
                <Globe className="h-3 w-3 text-green-400" />
                <span>Public</span>
              </>
            ) : (
              <>
                <Lock className="h-3 w-3 text-orange-400" />
                <span>Private</span>
              </>
            )
          }
        </span>
      </div>
      
      <!-- Description -->
      {
        repo.description && (
          <p class="text-gray-400 text-sm max-w-2xl">{repo.description}</p>
        )
      }
      
      <!-- Topics -->
      {
        repo.topics && repo.topics.length > 0 && (
          <div class="flex flex-wrap gap-2 mt-2">
            {repo.topics.map((topic: string) => (
              <a
                href={`/topics/${topic}`}
                class="inline-flex items-center rounded-full bg-cyan-500/10 border border-cyan-500/20 px-2.5 py-0.5 text-xs font-medium text-cyan-400 hover:bg-cyan-500/20 transition-colors"
              >
                {topic}
              </a>
            ))}
          </div>
        )
      }
    </div>
    
    <!-- Action Buttons -->
    <div class="flex items-center gap-2 flex-wrap">
      <!-- Watch -->
      <div class="flex items-center rounded-lg border border-white/10 bg-white/5 overflow-hidden">
        <button
          class="inline-flex items-center gap-1.5 px-3 py-2 text-sm font-medium text-gray-300 hover:bg-white/10 transition-colors"
        >
          <Eye className="h-4 w-4" />
          Watch
          <span class="ml-1 rounded-full bg-white/10 px-2 py-0.5 text-xs text-cyan-400">
            {repo.watchers || 0}
          </span>
        </button>
        <div class="w-px h-6 bg-white/10"></div>
        <button class="px-2 py-2 hover:bg-white/10 transition-colors text-gray-400">
          <ChevronDown className="h-4 w-4" />
        </button>
      </div>
      
      <!-- Fork -->
      <div class="flex items-center rounded-lg border border-white/10 bg-white/5 overflow-hidden">
        <button
          id="fork-btn"
          data-owner={repo.owner}
          data-repo={repo.name}
          class="inline-flex items-center gap-1.5 px-3 py-2 text-sm font-medium text-gray-300 hover:bg-white/10 transition-colors"
        >
          <GitFork className="h-4 w-4" />
          Fork
          <span class="ml-1 rounded-full bg-white/10 px-2 py-0.5 text-xs text-purple-400">
            {repo.forks || 0}
          </span>
        </button>
      </div>
      
      <!-- Star -->
      <div class="flex items-center rounded-lg border border-white/10 bg-white/5 overflow-hidden">
        <button
          class="inline-flex items-center gap-1.5 px-3 py-2 text-sm font-medium text-gray-300 hover:bg-white/10 transition-colors"
        >
          <Star className="h-4 w-4" />
          Star
          <span class="ml-1 rounded-full bg-white/10 px-2 py-0.5 text-xs text-yellow-400">
            {repo.stars || 0}
          </span>
        </button>
        <div class="w-px h-6 bg-white/10"></div>
        <button class="px-2 py-2 hover:bg-white/10 transition-colors text-gray-400">
          <ChevronDown className="h-4 w-4" />
        </button>
      </div>
    </div>
  </div>

  <!-- Navigation Tabs -->
  <div class="overflow-x-auto -mx-4 px-4">
    <nav class="flex gap-1 pt-3 min-w-max">
      {
        tabs.map((tab) => (
          <a
            href={tab.href}
            class:list={[
              "inline-flex items-center gap-2 px-4 py-2.5 rounded-lg text-sm font-medium transition-all",
              activeTab === tab.id
                ? "bg-white/10 text-white border border-white/10"
                : "text-gray-400 hover:text-white hover:bg-white/5",
            ]}
          >
            <tab.icon className="h-4 w-4" />
            {tab.label}
            {tab.count !== undefined && tab.count > 0 && (
              <span class:list={[
                "rounded-full px-2 py-0.5 text-xs font-medium",
                activeTab === tab.id
                  ? "bg-cyan-500/20 text-cyan-400"
                  : "bg-white/10 text-gray-400"
              ]}>
                {tab.count}
              </span>
            )}
          </a>
        ))
      }
    </nav>
  </div>
</div>
